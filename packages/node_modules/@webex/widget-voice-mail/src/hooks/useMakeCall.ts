import { useCallback, useContext } from 'react';
import { AdapterContext } from '../contexts/AdapterContext';

export const useMakeCall = () => {
  const ctx = useContext(AdapterContext);

  const makeCall = useCallback(
    (address: string, isVideo?: boolean) => {
      return makeCrossLaunchCall(address, !!isVideo);
    },
    [makeCrossLaunchCall]
  );

  return [makeCall];
};

export async function makeCrossLaunchCall(address: string, isAudio = false) {
  console.debug(
    `Making ${isAudio ? 'audio' : 'video'} call to address ${address}`
  );
  const url = `webextel://${address}`;
  //const crossLaunchCallToken = await getCrossLaunchToken();
  const callUrl = new URL(url);

  // TODO: add check for mobile and if audio calls are enabled
  callUrl.searchParams.append('jws', '');
  callUrl.searchParams.append('isAudio', String(!isAudio));
  window.open(callUrl.href);
}
