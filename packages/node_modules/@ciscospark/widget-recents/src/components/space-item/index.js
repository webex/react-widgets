import React from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';

import {
  ICON_TYPE_VIDEO_OUTLINE
} from '@ciscospark/react-component-icon';
import Avatar from '@ciscospark/react-component-avatar';
import Button from '@ciscospark/react-component-button';
import messages from '../../messages';
import styles from './styles.css';

export default function SpaceItem({
  avatarUrl,
  formatMessage,
  id,
  isUnread,
  lastActivityTime,
  latestActivity,
  name,
  onClick,
  onCallClick,
  teamName,
  teamColor,
  type
}) {

  function handleClick() {
    return onClick(id);
  }

  function handleCallClick(e) {
    if (type === `direct`) {
      e.stopPropagation();
      return onCallClick(id);
    }
    return false;
  }

  const actorName = latestActivity.actorName;
  let activityText = <span>{actorName}<span className={styles.midDot} />{latestActivity.text}</span>;

  switch (latestActivity.type) {
  case `update`: {
    if (latestActivity.object.objectType === `locusSessionSummary`) {
      if (latestActivity.object.duration < 2) {
        activityText = formatMessage(messages.unavailable, {actorName: name});
      }
    }
    break;
  }
  case `share`: {
    activityText = formatMessage(messages.sharedFile);
    break;
  }
  case `add`: {
    activityText = formatMessage(messages.addedToSpace, {actorName, targetName: latestActivity.text.split(` `)[0]});
    break;
  }
  default:
  }

  const hasCallSupport = typeof onCallClick === `function`;
  const isDirectSpace = type === `direct`;

  return ( // eslint-disable-next-line jsx-a11y/no-static-element-interactions
    <div
      className={classNames(`space-item`, styles.item, {
        [styles.directSpace]: isDirectSpace,
        [styles.hasCallSupport]: !!hasCallSupport
      })}
      onClick={handleClick}
      onKeyDown={handleClick}
      role="button"
      tabIndex="0"
    >
      {
        isUnread &&
        <div className={classNames(`space-unread-indicator`, styles.unreadIndicator)} />
      }
      <div className={classNames(`space-avatar-wrapper`, styles.avatarWrapper)}>
        <div className={classNames(`space-avatar-border`, type === `group` && styles.avatarGroup)}>
          <Avatar baseColor={teamColor} image={avatarUrl} name={name} />
        </div>
      </div>
      <div className={classNames(`space-item-meta`, styles.meta)}>
        {
          teamName &&
          <div
            className={classNames(`space-team-name`, styles.teamName)}
            style={teamColor && {color: teamColor}}
          >
            {teamName}
          </div>
        }
        <div className={classNames(`space-title`, styles.title, isUnread ? styles.isUnread : ``)}>
          {name}
        </div>
        <div className={classNames(`space-last-activity`, styles.lastActivity)}>
          {activityText}
        </div>
      </div>
      <div className={classNames(`space-last-activity-time`, styles.timestamp)}>
        {lastActivityTime}
      </div>
      {
        isDirectSpace && hasCallSupport &&
        <div className={classNames(`space-actions`, styles.actions)}>
          <Button
            buttonClassName={classNames(styles.actionButton, styles.callButton)}
            iconType={ICON_TYPE_VIDEO_OUTLINE}
            onClick={handleCallClick}
          />
        </div>
      }
    </div>
  );
}

SpaceItem.propTypes = {
  avatarUrl: PropTypes.string,
  formatMessage: PropTypes.func,
  id: PropTypes.string,
  isUnread: PropTypes.bool,
  lastActivityTime: PropTypes.string,
  latestActivity: PropTypes.object,
  name: PropTypes.string,
  onCallClick: PropTypes.func,
  onClick: PropTypes.func,
  teamColor: PropTypes.string,
  teamName: PropTypes.string,
  type: PropTypes.string
};
